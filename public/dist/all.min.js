function inherits(e,t){function a(){}a.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new a,e.prototype.constructor=e}function MarkerLabel_(e,t,a){this.marker_=e,this.handCursorURL_=e.handCursorURL,this.labelDiv_=document.createElement("div"),this.labelDiv_.style.cssText="position: absolute; overflow: hidden;",this.crossDiv_=MarkerLabel_.getSharedCross(t)}function MarkerWithLabel(e){e=e||{},e.labelContent=e.labelContent||"",e.labelAnchor=e.labelAnchor||new google.maps.Point(0,0),e.labelClass=e.labelClass||"markerLabels",e.labelStyle=e.labelStyle||{},e.labelInBackground=e.labelInBackground||!1,"undefined"==typeof e.labelVisible&&(e.labelVisible=!0),"undefined"==typeof e.raiseOnDrag&&(e.raiseOnDrag=!0),"undefined"==typeof e.clickable&&(e.clickable=!0),"undefined"==typeof e.draggable&&(e.draggable=!1),"undefined"==typeof e.optimized&&(e.optimized=!1),e.crossImage=e.crossImage||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png",e.handCursor=e.handCursor||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur",e.optimized=!1,this.label=new MarkerLabel_(this,e.crossImage,e.handCursor),google.maps.Marker.apply(this,arguments)}function filterImage(e){var t;for(t=0;t<e.length;t++)if(/\.((?!gif).)*$/.test(e[t]))return e[t];return"images/noimage.png"}function isMobile(){return $(window).width()/$(window).height()<=1||$(window).width()<=480}!function(e){var t=!1;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var a=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=a,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var a=arguments[e];for(var n in a)t[n]=a[n]}return t}function t(a){function n(t,r,i){var o;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},n.defaults,i),"number"==typeof i.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(e){}return r=a.write?a.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",r,i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}t||(o={});for(var l=document.cookie?document.cookie.split("; "):[],c=/(%[0-9A-Z]{2})+/g,m=0;m<l.length;m++){var d=l[m].split("="),g=d.slice(1).join("=");'"'===g.charAt(0)&&(g=g.slice(1,-1));try{var p=d[0].replace(c,decodeURIComponent);if(g=a.read?a.read(g,p):a(g,p)||g.replace(c,decodeURIComponent),this.json)try{g=JSON.parse(g)}catch(e){}if(t===p){o=g;break}t||(o[p]=g)}catch(e){}}return o}}return n.set=n,n.get=function(e){return n.call(n,e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,a){n(t,"",e(a,{expires:-1}))},n.withConverter=t,n}return t(function(){})}),inherits(MarkerLabel_,google.maps.OverlayView),MarkerLabel_.getSharedCross=function(e){var t;return"undefined"==typeof MarkerLabel_.getSharedCross.crossDiv&&(t=document.createElement("img"),t.style.cssText="position: absolute; z-index: 1000002; display: none;",t.style.marginLeft="-8px",t.style.marginTop="-9px",t.src=e,MarkerLabel_.getSharedCross.crossDiv=t),MarkerLabel_.getSharedCross.crossDiv},MarkerLabel_.prototype.onAdd=function(){var e,t,a,n,r,i,o,s=this,l=!1,c=!1,m=20,d="url("+this.handCursorURL_+")",g=function(e){e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},p=function(){s.marker_.setAnimation(null)};this.getPanes().markerLayer.appendChild(this.labelDiv_),"undefined"==typeof MarkerLabel_.getSharedCross.processed&&(this.getPanes().markerLayer.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=!0),this.listeners_=[google.maps.event.addDomListener(this.labelDiv_,"mouseover",function(e){(s.marker_.getDraggable()||s.marker_.getClickable())&&(this.style.cursor="pointer",google.maps.event.trigger(s.marker_,"mouseover",e))}),google.maps.event.addDomListener(this.labelDiv_,"mouseout",function(e){!s.marker_.getDraggable()&&!s.marker_.getClickable()||c||(this.style.cursor=s.marker_.getCursor(),google.maps.event.trigger(s.marker_,"mouseout",e))}),google.maps.event.addDomListener(this.labelDiv_,"mousedown",function(e){c=!1,s.marker_.getDraggable()&&(l=!0,this.style.cursor=d),(s.marker_.getDraggable()||s.marker_.getClickable())&&(google.maps.event.trigger(s.marker_,"mousedown",e),g(e))}),google.maps.event.addDomListener(document,"mouseup",function(t){var a;if(l&&(l=!1,s.eventDiv_.style.cursor="pointer",google.maps.event.trigger(s.marker_,"mouseup",t)),c){if(r){a=s.getProjection().fromLatLngToDivPixel(s.marker_.getPosition()),a.y+=m,s.marker_.setPosition(s.getProjection().fromDivPixelToLatLng(a));try{s.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(p,1406)}catch(e){}}s.crossDiv_.style.display="none",s.marker_.setZIndex(e),n=!0,c=!1,t.latLng=s.marker_.getPosition(),google.maps.event.trigger(s.marker_,"dragend",t)}}),google.maps.event.addListener(s.marker_.getMap(),"mousemove",function(n){var d;l&&(c?(n.latLng=new google.maps.LatLng(n.latLng.lat()-t,n.latLng.lng()-a),d=s.getProjection().fromLatLngToDivPixel(n.latLng),r&&(s.crossDiv_.style.left=d.x+"px",s.crossDiv_.style.top=d.y+"px",s.crossDiv_.style.display="",d.y-=m),s.marker_.setPosition(s.getProjection().fromDivPixelToLatLng(d)),r&&(s.eventDiv_.style.top=d.y+m+"px"),google.maps.event.trigger(s.marker_,"drag",n)):(t=n.latLng.lat()-s.marker_.getPosition().lat(),a=n.latLng.lng()-s.marker_.getPosition().lng(),e=s.marker_.getZIndex(),i=s.marker_.getPosition(),o=s.marker_.getMap().getCenter(),r=s.marker_.get("raiseOnDrag"),c=!0,s.marker_.setZIndex(1e6),n.latLng=s.marker_.getPosition(),google.maps.event.trigger(s.marker_,"dragstart",n)))}),google.maps.event.addDomListener(document,"keydown",function(e){c&&27===e.keyCode&&(r=!1,s.marker_.setPosition(i),s.marker_.getMap().setCenter(o),google.maps.event.trigger(document,"mouseup",e))}),google.maps.event.addDomListener(this.labelDiv_,"click",function(e){(s.marker_.getDraggable()||s.marker_.getClickable())&&(n?n=!1:(google.maps.event.trigger(s.marker_,"click",e),g(e)))}),google.maps.event.addDomListener(this.labelDiv_,"dblclick",function(e){(s.marker_.getDraggable()||s.marker_.getClickable())&&(google.maps.event.trigger(s.marker_,"dblclick",e),g(e))}),google.maps.event.addListener(this.marker_,"dragstart",function(e){c||(r=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(e){c||r&&(s.setPosition(m),s.labelDiv_.style.zIndex=1e6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(e){c||r&&s.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){s.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){s.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){s.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){s.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){s.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){s.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){s.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){s.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){s.setStyles()})]},MarkerLabel_.prototype.onRemove=function(){var e;for(this.labelDiv_.parentNode.removeChild(this.labelDiv_),e=0;e<this.listeners_.length;e++)google.maps.event.removeListener(this.listeners_[e])},MarkerLabel_.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},MarkerLabel_.prototype.setContent=function(){var e=this.marker_.get("labelContent");"undefined"==typeof e.nodeType?this.labelDiv_.innerHTML=e:(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(e))},MarkerLabel_.prototype.setTitle=function(){this.labelDiv_.title=this.marker_.getTitle()||""},MarkerLabel_.prototype.setStyles=function(){var e,t;this.labelDiv_.className=this.marker_.get("labelClass"),this.labelDiv_.style.cssText="",t=this.marker_.get("labelStyle");for(e in t)t.hasOwnProperty(e)&&(this.labelDiv_.style[e]=t[e]);this.setMandatoryStyles()},MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute",this.labelDiv_.style.overflow="hidden","undefined"!=typeof this.labelDiv_.style.opacity&&""!==this.labelDiv_.style.opacity&&(this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+100*this.labelDiv_.style.opacity+')"',this.labelDiv_.style.filter="alpha(opacity="+100*this.labelDiv_.style.opacity+")"),this.setAnchor(),this.setPosition(),this.setVisible()},MarkerLabel_.prototype.setAnchor=function(){var e=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-e.x+"px",this.labelDiv_.style.marginTop=-e.y+"px"},MarkerLabel_.prototype.setPosition=function(e){var t=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());"undefined"==typeof e&&(e=0),this.labelDiv_.style.left=Math.round(t.x)+"px",this.labelDiv_.style.top=Math.round(t.y-e)+"px",this.setZIndex()},MarkerLabel_.prototype.setZIndex=function(){var e=this.marker_.get("labelInBackground")?-1:1;"undefined"==typeof this.marker_.getZIndex()?this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+e:this.labelDiv_.style.zIndex=this.marker_.getZIndex()+e},MarkerLabel_.prototype.setVisible=function(){this.marker_.get("labelVisible")?this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none":this.labelDiv_.style.display="none"},inherits(MarkerWithLabel,google.maps.Marker),MarkerWithLabel.prototype.setMap=function(e){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(e)};var Map={map:null,infowindow:null,markers:[],init:function(e,t,a,n){this.map=new google.maps.Map(document.getElementById(e),{center:{lat:t,lng:a},zoom:n,disableDefaultUI:!0,mapTypeControl:!1,zoomControl:!0,streetViewControl:!0}),this.map.addListener("click",this.resetSelectMarker.bind(this))},addEventOnce:function(e,t){google.maps.event.addListenerOnce(this.map,e,t)},resetSelectMarker:function(){$(".card").removeClass("focus"),this.infowindow&&this.infowindow.close()},showMarkers:function(){this.setMapOnAll(this.map)},clearMarkers:function(){this.setMapOnAll(null)},deleteMarkers:function(){this.clearMarkers(),this.markers=[]},addMarker:function(e,t,a,n){var r=new MarkerWithLabel({position:new google.maps.LatLng(e,t),map:this.map,raiseOnDrag:!0,labelContent:String(a),labelAnchor:new google.maps.Point(10,10),labelClass:"map-labels",labelInBackground:!1,icon:this.pinSymbol()});r.addListener("click",function(){var e=0;this.resetSelectMarker(),isMobile()?e=.4*$(window).height():(this.createInfoBox(n),this.infowindow.open(this.map,r)),$("html, body").animate({scrollTop:$("#card"+a).offset().top-60-e},250),$("#card"+a).addClass("focus")}.bind(this)),this.markers.push(r)},setMapOnAll:function(e){for(var t=0;t<this.markers.length;t++)null===e&&google.maps.event.clearInstanceListeners(this.markers[t]),this.markers[t].setMap(e)},pinSymbol:function(e){return e||(e="#2185D0"),{path:"M -10 -10 L 10 -10 L 10 10 L 3 10 L 0 14  L -3 10 L -10 10 Z",fillColor:e,fillOpacity:1,strokeColor:"#D4D4D5",strokeWeight:1}},createInfoBox:function(e){this.infowindow=new InfoBox({boxStyle:{background:"#FFF",width:"200px"},pixelOffset:new google.maps.Size((-100),13),content:['<div class="ui card">','<div class="card-image-cropped image" style="background-image:url('+filterImage(e.images)+')">',"</div>",'<div class="content">',"<h5>"+e.title+"</h5>","</div>","</div>"].join(""),closeBoxURL:""})},highlightMarker:function(e){this.markers[e].setIcon(this.pinSymbol("#FBBD08")),this.markers[e].setZIndex(1e3)},deHighlightMarker:function(e){this.markers[e].setIcon(this.pinSymbol()),this.markers[e].setZIndex(1)}};const IPAD_SIZE=768,MapView=React.createClass({displayName:"MapView",mapUpdate:function(){Map.resetSelectMarker();const e={lat:Map.map.getCenter().lat(),lng:Map.map.getCenter().lng(),zoom:Map.map.getZoom()};Cookies.set("map_info",e),this.retrieveData(),$("html, body").animate({scrollTop:$("#container").offset().top-50},250)},retrieveData:function(){const e=this,t=Map.map.getBounds();$(".refresh_button").off("click",this.retrieveData).addClass("loading"),$.ajax({url:"./api/",dataType:"json",data:{ne_lat:t.getNorthEast().lat(),ne_lng:t.getNorthEast().lng(),sw_lat:t.getSouthWest().lat(),sw_lng:t.getSouthWest().lng()},success:function(t){var a,n,r,i,o=0;e.props.onDataUpdate(t),Map.deleteMarkers();for(r in t)i=JSON.parse(r),a=i[1],n=i[0],Map.addMarker(a,n,++o,t[r][0])},complete:function(){$(".refresh_button").on("click",this.retrieveData).removeClass("loading")}})},componentDidMount:function(){var e=25.0468165,t=121.507962,a=16;const n=Cookies.getJSON("map_info");$.isEmptyObject(n)||(e=n.lat,t=n.lng,a=n.zoom),Map.init("map",e,t,a),Map.addEventOnce("bounds_changed",this.mapUpdate),$(".refresh_button").on("click",this.mapUpdate)},render:function(){return React.createElement("div",null,React.createElement("button",{className:"ui circular red icon button refresh_button"},React.createElement("i",{className:"refresh icon"})),React.createElement("div",{id:"map"}))}}),ListView=React.createClass({displayName:"ListView",cardEnter:function(e){Map.highlightMarker(e-1)},cardLeave:function(e){Map.deHighlightMarker(e-1)},render:function(){var e,t,a,n=this.props.data,r=[],i=0,o="";for(a in this.props.data)e=n[a],t=e[0],o={backgroundImage:"url("+filterImage(t.images)+")"},r.push(React.createElement("div",{className:"card",id:"card"+ ++i,key:"card"+i,onMouseEnter:this.cardEnter.bind(this,i),onMouseLeave:this.cardLeave.bind(this,i)},React.createElement("a",{href:t.url,target:"_blank"},React.createElement("div",{className:"ui card-image-cropped image",style:o},React.createElement("div",{className:"ui yellow ribbon label"},i))),React.createElement("div",{className:"content"},React.createElement("a",{href:t.url,target:"_blank"},React.createElement("h5",null,t.title),React.createElement("div",{className:"small text description"},t.desc,"...")))));return React.createElement("div",{id:"list"},React.createElement("div",{className:"ten wide column"},React.createElement("div",{className:"ui two stackable cards"},r)),React.createElement(Footer,null))}}),Footer=React.createClass({displayName:"Footer",render:function(){return React.createElement("div",{className:"ui vertical footer segment"},React.createElement("div",{className:"ui center aligned container"},React.createElement("div",{className:"ui divider"}),React.createElement("a",{href:"http://huaying.github.io/",target:"_blank"},React.createElement("i",{className:"big child icon"})),React.createElement("a",{href:"https://www.facebook.com/HuayingTsai",target:"_blank"},React.createElement("i",{className:"big facebook f icon"})),React.createElement("a",{href:"https://github.com/huaying",target:"_blank"},React.createElement("i",{className:"big github icon"})),React.createElement("a",{href:"https://www.linkedin.com/in/huayingtsai",target:"_blank"},React.createElement("i",{className:"big linkedin icon"})),React.createElement("div",{className:"ui divider"}),React.createElement("div",{className:"content"},React.createElement("b",null,"地圖美食 - GeoPixnet"),React.createElement("br",null),React.createElement("b",null,"Copyright © 2016 Huaying. All Rights Reserved"))))}}),MainMenu=React.createClass({displayName:"MainMenu",render:function(){return React.createElement("div",{className:"ui inverted blue fixed main menu"},React.createElement("div",{className:"left menu"},React.createElement("div",{className:"item"},React.createElement("b",null,React.createElement("i",{className:"map outline icon"}),React.createElement("i",{className:"food icon"}),"地圖美食 - GeoPixnet"))),React.createElement("div",{className:"right menu"},React.createElement("div",{className:"item"},React.createElement("a",{href:"mailto:royal3501@gmail.com",target:"_blank"},React.createElement("b",null,"Feedback")))))}}),Container=React.createClass({displayName:"Container",getInitialState:function(){return{data:[]}},handleDataUpdate:function(e){this.setState({data:e})},render:function(){return React.createElement("div",{id:"container"},React.createElement(MainMenu,null),React.createElement(ListView,{data:this.state.data}),React.createElement(MapView,{onDataUpdate:this.handleDataUpdate}))}});ReactDOM.render(React.createElement(Container,null),document.getElementById("container"));